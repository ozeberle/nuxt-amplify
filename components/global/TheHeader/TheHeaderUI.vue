<template>
  <div class="header">
    <header>
      <nav class="header__nav extended-content-container">
        <div class="header__nav__container extended-content">
          <div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl">
            <a href="#" class="flex items-center">
              <svg width="96" height="32" viewBox="0 0 96 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M72.8242 3.10355C72.8242 4.26647 73.7699 5.19977 74.9315 5.19977C76.0931 5.19977 77.0388 4.25906 77.0388 3.10355C77.0388 1.94062 76.0931 1.00732 74.9315 1.00732C73.7699 1.00732 72.8242 1.94803 72.8242 3.10355Z" fill="#002157" />
                <path d="M69.101 21.9993H65.1842C64.8789 21.9993 64.5811 21.8733 64.3726 21.6511L55.3999 12.3181V20.903C55.3999 21.5104 54.901 21.9993 54.2829 21.9993H51.781C51.163 21.9993 50.6641 21.5104 50.6641 20.903V2.10366C50.6641 1.49628 51.163 1.00741 51.781 1.00741H54.2829C54.901 1.00741 55.3999 1.49628 55.3999 2.10366V10.2367L64.0598 1.34073C64.2683 1.12592 64.5662 1 64.864 1H68.6542C69.1456 1 69.3988 1.58517 69.0563 1.9333L60.0165 11.0441L69.5031 21.0808C69.8381 21.4289 69.585 21.9993 69.101 21.9993Z" fill="#002157" />
                <path d="M72.8242 20.9032V8.40738C72.8242 7.79999 73.2859 7.30371 73.8518 7.30371H76.0187C76.5846 7.30371 77.0462 7.79999 77.0462 8.40738V20.9032C77.0462 21.5106 76.5846 22.0069 76.0187 22.0069H73.8518C73.2859 21.9995 72.8242 21.5106 72.8242 20.9032Z" fill="#002157" />
                <path d="M94.984 8.40738V20.9032C94.984 21.5106 94.4702 22.0069 93.8447 22.0069H91.5662C90.9333 22.0069 90.4269 21.5106 90.4269 20.9032V19.9107C89.9504 20.6662 89.3249 21.244 88.5505 21.6439C87.7761 22.0439 86.8974 22.2439 85.9294 22.2439C84.0083 22.2439 82.5711 21.7328 81.6329 20.7032C80.6873 19.6736 80.2256 18.1256 80.2256 16.0441V8.40738C80.2256 7.79999 80.7394 7.30371 81.3649 7.30371H83.7625C84.3955 7.30371 84.9018 7.79999 84.9018 8.40738V16.133C84.9018 17.0145 85.0954 17.6589 85.4752 18.0811C85.8549 18.5033 86.4432 18.7107 87.225 18.7107C88.1409 18.7107 88.8781 18.407 89.444 17.8145C90.0099 17.2145 90.2929 16.4293 90.2929 15.4516V8.41478C90.2929 7.8074 90.8067 7.31112 91.4322 7.31112H93.8373C94.4777 7.30371 94.984 7.79999 94.984 8.40738Z" fill="#002157" />
                <path d="M37.4395 17.5623C40.3211 17.5623 42.8529 15.5994 44.2825 12.6514C43.8432 17.9105 40.4105 22.0066 36.2481 22.0066C36.0545 22.0066 35.8683 21.9992 35.6821 21.977C35.6598 21.977 35.6375 21.9696 35.6077 21.9696C32.8972 21.7251 30.0453 19.9919 28.1614 18.6141C27.2158 17.9179 26.5158 17.3105 26.1956 17.029C26.151 16.992 26.1137 16.9549 26.0839 16.9327L26.0393 16.8957L26.0169 16.8809C26.002 16.8735 26.002 16.866 26.002 16.866L19.6578 11.0662L19.3674 10.7996L19.3302 10.77C19.1217 10.57 18.9951 10.2885 18.9951 9.9774C18.9951 9.57741 19.2036 9.22927 19.5164 9.03669L21.8619 7.54785L27.1934 12.4218C27.1934 12.4218 27.2009 12.4292 27.2083 12.4366L27.2307 12.4514L27.2753 12.4884C27.3051 12.5106 27.3424 12.5477 27.387 12.5847C27.7072 12.8662 28.4072 13.4736 29.3528 14.1698C31.2367 15.555 34.0886 17.2808 36.7991 17.5253C36.8214 17.5253 36.8438 17.5327 36.8735 17.5327C37.0597 17.5475 37.2458 17.5623 37.4395 17.5623Z" fill="#AB3B87" />
                <path d="M36.2478 1.00732C40.7156 1.00732 44.3344 5.71086 44.3344 11.5033C44.3344 11.8884 44.3195 12.2736 44.2898 12.6514C42.8601 15.5994 40.3284 17.5623 37.4467 17.5623C37.2605 17.5623 37.0669 17.5549 36.8808 17.5327C36.8584 17.5327 36.8361 17.5253 36.8063 17.5253C34.0959 17.2808 31.2439 15.5476 29.3601 14.1698C28.4144 13.4736 27.707 12.8662 27.3942 12.5847C27.3496 12.5477 27.3123 12.5106 27.2826 12.4884L27.2379 12.4514L27.2155 12.4366C27.2081 12.4291 27.2006 12.4217 27.2006 12.4217L21.8691 7.54783L26.0092 4.9183C26.0092 4.9183 26.9922 4.34054 28.1612 3.74056C30.0823 2.75541 32.9342 1.45175 35.1905 1.10362C35.533 1.03695 35.883 1.00732 36.2478 1.00732Z" fill="#55286A" />
                <path d="M20.8271 14.1998C20.9984 14.3628 21.1101 14.585 21.1101 14.8368C21.1101 15.1553 20.9388 15.4294 20.6782 15.5849L15.2722 18.8737C15.2722 18.8737 14.4532 19.3329 13.4777 19.8218C11.8768 20.6144 9.5014 21.6514 7.6175 21.9329C7.3271 21.9773 7.0367 22.0069 6.73885 22.0069C3.01573 22.0069 0 18.2441 0 13.6072C0 8.97035 3.01573 5.20752 6.73885 5.20752C6.89522 5.20752 7.05159 5.21493 7.20796 5.22974C7.2303 5.22974 7.24519 5.22974 7.26753 5.23715C9.53119 5.42973 11.8991 6.81487 13.4702 7.92594C14.2596 8.48148 14.8478 8.97035 15.1084 9.19256C15.1457 9.22219 15.1754 9.25182 15.1978 9.27404L15.235 9.30367L15.2499 9.31849C15.2573 9.32589 15.2648 9.3333 15.2648 9.3333L20.5516 13.9702L20.7973 14.185L20.8271 14.1998Z" fill="#002157" />
              </svg>
            </a>
          </div>
        </div>
      </nav>
      <div class="header__hero extended-content-container" :style="{backgroundImage: bgCls}">
        <div class="header__hero__container extended-content">
          <h1 class="header__hero__container__title">
            Vuelos de {{ od.origin }} a {{ od.destination }} (BOG-YYZ)
          </h1>
          <h2 class="header__hero__container__subtitle">
            desde COP 97.00
          </h2>
        </div>
      </div>
      <div class="header__search">
        <div class="header__search__title">
          <div>
            <RadioButtonUI name="typeFly" title="Sólo ida" :checked="true" value="O" @change="changeChk" />
            <RadioButtonUI name="typeFly" title="Ida y vuelta" value="R" @change="changeChk" />
          </div>
          <div>
            <DropdownPassengerUI @change="getCode" />
            <DropdownInputUI title="Código promocional" placeholder="Introduzca su código" button-title="Listo" @change="getCode" />
          </div>
        </div>
        <div class="header__search__subtitle">
          <AutoCompleteUI
            title="Desde"
            placeholder="Ingresá el origen"
            icon-left="flight_land"
            help-text="Helptext"
            :items="flys"
            @change="getCode"
          />
          <AutoCompleteUI
            title="Desde"
            placeholder="Ingresá el destino"
            icon-left="flight_takeoff"
            help-text="Helptext"
            :items="flys"
            @change="getCode"
          />
          <div class="header__search__subtitle__from">
            <label for="label-from">Fecha ida</label>
            <VueDatePicker
              :model-value="dateF"
              locale="es"
              :enable-time-picker="false"
              :range="!onlyFrom"
              :max-date="maxDate"
              :min-date="new Date()"
              auto-apply
              :format="format"
              multi-calendars
              partial-range
              input-class-name="dp-custom-input"
              @update:model-value="handleDate"
            >
              <template #input-icon>
                <IconUI name="calendar" class="icon-calendar" />
              </template>
            </VueDatePicker>
          </div>
          <div class="header__search__subtitle__to">
            <label for="label-from">Fecha vuelta</label>
            <VueDatePicker
              v-model="dateT"
              :disabled="onlyFrom"
              locale="es"
              :enable-time-picker="false"
              :range="!onlyFrom"
              auto-apply
              :max-date="maxDate"
              :min-date="new Date()"
              :format="formatT"
              multi-calendars
              input-class-name="dp-custom-input"
              partial-range
              @update:model-value="handleDate"
            >
              <template #input-icon>
                <IconUI name="calendar" class="icon-calendar" />
              </template>
            </VueDatePicker>
          </div>
          <ButtonInputUI class="header__search__subtitle__button-save" title="Buscar" @on-save="onSave" />
        </div>
      </div>
    </header>
  </div>
</template>

<script setup lang="ts">
import VueDatePicker from '@vuepic/vue-datepicker'
import '@vuepic/vue-datepicker/dist/main.css'
import moment from 'moment'
import type { TheHeaderUIProps } from './TheHeaderUIProps'
const route = useRoute()
const slug = route.params.slug as string

const od = useDestinationOrigin(slug)

const props = withDefaults(defineProps<TheHeaderUIProps>(), {
  alt: 'Logo'
})

const bgCls = `url('${props.src}')`

const onlyFrom = computed(() => model.value.typeFly === 'O')

const model = ref<{typeFly: string; codePromo: string; from: string; to:string; dateFrom?: Date; dateTo?: Date }>({
  typeFly: 'O',
  codePromo: '',
  from: '',
  to: '',
  dateFrom: undefined,
  dateTo: undefined
})

const flys = ref([{
  title: '',
  subTitle: ''
}])

const changeChk = (value:string) => {
  model.value.typeFly = value
  if (value === 'R' && !dateT.value) {
    const _df = dateF.value as Date
    const _DateT = new Date(new Date().setDate(_df.getDate() + 7))
    dateF.value = [_df, _DateT]
    dateT.value = [_df, _DateT]
  }
}

const getCode = (value:string) => {
  model.value.codePromo = value
}

const dateF = ref()
const dateT = ref()

const maxDate = computed(() => new Date(new Date().setDate(new Date().getDate() + 355)))

const format = (date:[Date, Date]|Date) => {
  if (isArray(date)) {
    return moment(date[0]).format('DD MMM yyyy')
  } else { return moment(date).format('DD MMM yyyy') }
}
const formatT = (date:[Date, Date]|Date) => {
  if (isArray(date)) {
    return moment(date[1]).format('DD MMM yyyy')
  } else { return moment(date).format('DD MMM yyyy') }
}

const handleDate = (modelData:[Date, Date] | Date) => {
  if (isArray(modelData)) {
    model.value.dateFrom = modelData[0]
    model.value.dateTo = modelData[1]
  } else {
    model.value.dateFrom = modelData
  }

  dateF.value = modelData
  if (!onlyFrom.value) {
    dateT.value = modelData
  }
}

const onSave = () => {
  // TODO SAVE
}

onMounted(() => {
  const startDate = new Date(new Date().setDate(new Date().getDate() + 7))
  const endDate = new Date(new Date().setDate(startDate.getDate() + 7))
  if (onlyFrom.value) {
    dateF.value = startDate
  } else {
    dateF.value = [startDate, endDate]
    dateT.value = [startDate, endDate]
  }
})

</script>

<style lang="postcss" scoped>
.header {
  @apply bg-gray-200;

  &__nav {
    @apply bg-white;

    &__container {
      @apply border-gray-200 px-4 lg:px-6 py-2.5;
    }
  }

  &__hero{
    @apply h-[315px] bg-no-repeat bg-cover;

    &__container{
      @apply flex flex-col justify-center lg:max-w-[980px] h-[315px] mx-auto ;

      &__title{
       @apply text-white  font-normal leading-[48px];
      }
      &__subtitle{
        @apply text-white  font-bold leading-[67.5px];
      }
    }
  }

  &__search {
    @apply lg:max-w-[980px] m-auto  border border-gray-500 rounded-lg bg-white pt-[16px] pb-[24px] px-[16px] -mt-8;

    &__title{
      @apply flex flex-col  lg:flex-row gap-2  lg:items-center;

      & :nth-child(1){
        @apply flex  md:flex-row gap-3;
      }
      & :nth-child(2){
        @apply flex  md:flex-row gap-3;
      }

    }
    &__subtitle{
      @apply grid grid-cols-1 md:grid-cols-2 lg:flex gap-2 items-center;

      &__button-save{
       @apply col-span-2 place-self-end lg:place-self-center;
      }

      &__datepicker{
        @apply relative -top-4
      }

      &__from{
        label {
          @apply relative -top-2 text-[14px]
        }

      }
      &__to{
        label {
          @apply relative -top-2 text-[14px] ;
        }

      }
    }
  }

}

  .icon-calendar{
    @apply relative left-2 text-[#34373A];
  }
  .dp__main{
    @apply mt-3 relative -top-4;

  }

</style>

<style>
.dp-custom-input{
  @apply  py-[9px] border-gray-800 border-solid hover:border-gray-800;
}
</style>
